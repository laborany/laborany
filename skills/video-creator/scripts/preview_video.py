#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           è§†é¢‘é¢„è§ˆè„šæœ¬                                        â•‘
â•‘  å¯åŠ¨ Remotion Studio è¿›è¡Œå®æ—¶é¢„è§ˆ                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

import os
import sys
import subprocess
from pathlib import Path


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚                              æ ¸å¿ƒå‡½æ•°                                        â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

def find_project_root(start_dir: Path) -> Path | None:
    """å‘ä¸ŠæŸ¥æ‰¾åŒ…å« package.json çš„ç›®å½•"""
    current = start_dir.resolve()
    while current != current.parent:
        if (current / "package.json").exists():
            return current
        current = current.parent
    return None


def start_studio(project_dir: Path) -> int:
    """å¯åŠ¨ Remotion Studio"""
    print(f"ğŸ¬ å¯åŠ¨ Remotion Studio...")
    print(f"   é¡¹ç›®ç›®å½•: {project_dir}")
    print()
    print("æç¤º: æŒ‰ Ctrl+C åœæ­¢é¢„è§ˆ")
    print()

    try:
        result = subprocess.run(
            ["npx", "remotion", "studio"],
            cwd=project_dir,
        )
        return result.returncode
    except KeyboardInterrupt:
        print("\nğŸ‘‹ é¢„è§ˆå·²åœæ­¢")
        return 0
    except FileNotFoundError:
        print("âŒ npx æœªæ‰¾åˆ°ï¼Œè¯·å…ˆå®‰è£… Node.js")
        return 1


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚                              ä¸»å‡½æ•°                                          â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

def main():
    """ä¸»å‡½æ•°"""
    # ç¡®å®šé¡¹ç›®ç›®å½•
    if len(sys.argv) > 1:
        project_dir = Path(sys.argv[1]).resolve()
    else:
        project_dir = find_project_root(Path.cwd())

    if not project_dir:
        print("âŒ æœªæ‰¾åˆ° Remotion é¡¹ç›®")
        print("   è¯·åœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œï¼Œæˆ–æŒ‡å®šé¡¹ç›®è·¯å¾„")
        print("   ç”¨æ³•: python preview_video.py [é¡¹ç›®ç›®å½•]")
        return 1

    if not (project_dir / "package.json").exists():
        print(f"âŒ ç›®å½•ä¸æ˜¯æœ‰æ•ˆçš„ Remotion é¡¹ç›®: {project_dir}")
        return 1

    return start_studio(project_dir)


if __name__ == "__main__":
    sys.exit(main())
