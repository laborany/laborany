/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘                      Artifact Preview å·¥å…·å‡½æ•°                            â•‘
 * â•‘                                                                          â•‘
 * â•‘  è®¾è®¡å“²å­¦ï¼šç”¨ Map æ˜ å°„æ›¿ä»£æ¡ä»¶åˆ†æ”¯ï¼Œè®©æ‰©å±•åè‡ªç„¶æ˜ å°„åˆ°åˆ†ç±»                      â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

import type { FileCategory } from './types'

/* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                      æ‰©å±•å â†’ åˆ†ç±» æ˜ å°„è¡¨                                  â”‚
 * â”‚                                                                          â”‚
 * â”‚  å¥½å“å‘³ï¼šä¸€å¼ è¡¨æ¶ˆé™¤æ‰€æœ‰ if/elseï¼Œæ–°ç±»å‹åªéœ€åŠ ä¸€è¡Œ                             â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */
const EXT_CATEGORY_MAP: Record<string, FileCategory> = {
  // HTML
  html: 'html', htm: 'html',
  // å›¾ç‰‡
  png: 'image', jpg: 'image', jpeg: 'image', gif: 'image',
  svg: 'image', webp: 'image', bmp: 'image', ico: 'image',
  // Markdown
  md: 'markdown', markdown: 'markdown',
  // ä»£ç 
  js: 'code', jsx: 'code', ts: 'code', tsx: 'code',
  py: 'code', rb: 'code', go: 'code', rs: 'code',
  java: 'code', c: 'code', cpp: 'code', h: 'code', hpp: 'code',
  css: 'code', scss: 'code', less: 'code',
  json: 'code', xml: 'code', yaml: 'code', yml: 'code',
  sql: 'code', sh: 'code', bash: 'code', zsh: 'code',
  toml: 'code', txt: 'code', csv: 'code',
  // PDF
  pdf: 'pdf',
  // éŸ³é¢‘
  mp3: 'audio', wav: 'audio', ogg: 'audio', m4a: 'audio', flac: 'audio',
  aac: 'audio', wma: 'audio',
  // è§†é¢‘
  mp4: 'video', webm: 'video', mov: 'video', avi: 'video', mkv: 'video',
  wmv: 'video', flv: 'video',
  // Excel
  xlsx: 'excel', xls: 'excel', xlsm: 'excel',
  // Word
  docx: 'docx',
  // PowerPoint
  pptx: 'pptx', ppt: 'pptx',
  // å­—ä½“
  ttf: 'font', otf: 'font', woff: 'font', woff2: 'font',
}

/* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                      æ‰©å±•å â†’ è¯­è¨€ æ˜ å°„è¡¨                                  â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */
const EXT_LANG_MAP: Record<string, string> = {
  js: 'javascript', jsx: 'javascript', ts: 'typescript', tsx: 'typescript',
  py: 'python', rb: 'ruby', go: 'go', rs: 'rust',
  java: 'java', c: 'c', cpp: 'cpp', h: 'c', hpp: 'cpp',
  css: 'css', scss: 'scss', less: 'less',
  html: 'html', htm: 'html',
  json: 'json', xml: 'xml', yaml: 'yaml', yml: 'yaml',
  md: 'markdown', sql: 'sql',
  sh: 'bash', bash: 'bash', zsh: 'bash',
  toml: 'toml', txt: 'plaintext', csv: 'plaintext',
}

/* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                      æ‰©å±•å â†’ å›¾æ ‡ æ˜ å°„è¡¨                                  â”‚
 * â”‚                                                                          â”‚
 * â”‚  å¥½å“å‘³ï¼šç»Ÿä¸€çš„å›¾æ ‡æ˜ å°„ï¼Œæ¶ˆé™¤å„å¤„é‡å¤å®šä¹‰                                     â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */
const EXT_ICON_MAP: Record<string, string> = {
  // ç½‘é¡µ
  html: 'ğŸŒ', htm: 'ğŸŒ',
  // æ–‡æ¡£
  pdf: 'ğŸ“•',
  doc: 'ğŸ“˜', docx: 'ğŸ“˜',
  xls: 'ğŸ“—', xlsx: 'ğŸ“—',
  ppt: 'ğŸ“™', pptx: 'ğŸ“™',
  // å›¾ç‰‡
  png: 'ğŸ–¼ï¸', jpg: 'ğŸ–¼ï¸', jpeg: 'ğŸ–¼ï¸', gif: 'ğŸ–¼ï¸', svg: 'ğŸ–¼ï¸', webp: 'ğŸ–¼ï¸',
  // æ–‡æœ¬
  txt: 'ğŸ“„', md: 'ğŸ“',
  // æ•°æ®
  json: 'ğŸ“‹', csv: 'ğŸ“Š', yaml: 'ğŸ“‹', yml: 'ğŸ“‹',
  // ä»£ç 
  py: 'ğŸ', js: 'ğŸ“œ', ts: 'ğŸ“œ', jsx: 'ğŸ“œ', tsx: 'ğŸ“œ',
  // éŸ³è§†é¢‘
  mp3: 'ğŸµ', wav: 'ğŸµ', ogg: 'ğŸµ',
  mp4: 'ğŸ¬', webm: 'ğŸ¬', mov: 'ğŸ¬',
  // å­—ä½“
  ttf: 'ğŸ”¤', otf: 'ğŸ”¤', woff: 'ğŸ”¤', woff2: 'ğŸ”¤',
}

/* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                           å…¬å¼€å‡½æ•°                                        â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */

/** ä»æ–‡ä»¶åæå–æ‰©å±•å */
export function getExt(name: string): string {
  return name.split('.').pop()?.toLowerCase() || ''
}

/** æ ¹æ®æ‰©å±•åè·å–æ–‡ä»¶åˆ†ç±» */
export function getCategory(ext: string): FileCategory {
  return EXT_CATEGORY_MAP[ext] || 'binary'
}

/** æ ¹æ®æ‰©å±•åè·å–è¯­æ³•é«˜äº®è¯­è¨€ */
export function getLang(ext: string): string {
  return EXT_LANG_MAP[ext] || 'plaintext'
}

/** æ ¼å¼åŒ–æ–‡ä»¶å¤§å° */
export function formatSize(bytes: number): string {
  if (bytes < 1024) return `${bytes} B`
  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`
  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`
}

/** åˆ¤æ–­æ˜¯å¦å¯é¢„è§ˆ */
export function isPreviewable(ext: string): boolean {
  const cat = getCategory(ext)
  return cat !== 'binary'
}

/** æ ¹æ®æ‰©å±•åè·å–æ–‡ä»¶å›¾æ ‡ */
export function getFileIcon(ext: string): string {
  return EXT_ICON_MAP[ext.toLowerCase()] || 'ğŸ“„'
}

/* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                           å¤–éƒ¨åº”ç”¨æ‰“å¼€                                    â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */

/** ç”¨ç³»ç»Ÿé»˜è®¤åº”ç”¨æ‰“å¼€æ–‡ä»¶ */
export async function openFileExternal(path: string): Promise<void> {
  if (!path) return
  try {
    await fetch('/api/files/open', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ path }),
    })
  } catch (err) {
    console.error('[Preview] Failed to open file:', err)
  }
}

