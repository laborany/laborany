/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘                      å¿«é€Ÿå¼€å§‹é…ç½® Hook                                    â•‘
 * â•‘                                                                          â•‘
 * â•‘  åŠŸèƒ½ï¼šç®¡ç†é¦–é¡µå¿«é€Ÿå¼€å§‹åœºæ™¯çš„é…ç½®                                           â•‘
 * â•‘  ç‰¹æ€§ï¼šlocalStorage æŒä¹…åŒ–ã€é»˜è®¤é…ç½®ã€è‡ªå®šä¹‰æ”¯æŒ                            â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

import { useState, useEffect, useCallback } from 'react'

/* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                           ç±»å‹å®šä¹‰                                        â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */
export interface QuickStartItem {
  skillId: string
  icon: string
  name: string
  description: string
}

/* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                           å¸¸é‡å®šä¹‰                                        â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */
const STORAGE_KEY = 'laborany:quick-start'
const MAX_ITEMS = 6

/** é»˜è®¤å¿«é€Ÿå¼€å§‹åœºæ™¯ */
export const DEFAULT_SCENARIOS: QuickStartItem[] = [
  { skillId: 'docx', icon: 'ğŸ“', name: 'Wordæ–‡æ¡£åŠ©æ‰‹', description: 'åˆ›å»ºå’Œç¼–è¾‘Wordæ–‡æ¡£' },
  { skillId: 'pptx', icon: 'ğŸ“Š', name: 'PPTæ¼”ç¤ºåŠ©æ‰‹', description: 'åˆ¶ä½œç²¾ç¾æ¼”ç¤ºæ–‡ç¨¿' },
  { skillId: 'xlsx', icon: 'ğŸ“ˆ', name: 'Excelè¡¨æ ¼åŠ©æ‰‹', description: 'æ•°æ®åˆ†æä¸å¯è§†åŒ–' },
  { skillId: 'paper-explainer', icon: 'ğŸ“š', name: 'è®ºæ–‡è®²è§£åŠ©æ‰‹', description: 'æ·±åº¦è§£è¯»å­¦æœ¯è®ºæ–‡' },
  { skillId: 'diagram', icon: 'ğŸ“', name: 'è®ºæ–‡å›¾è¡¨åŠ©æ‰‹', description: 'æµç¨‹å›¾ã€æ¶æ„å›¾ã€æ—¶åºå›¾' },
  { skillId: 'video-creator', icon: 'ğŸ¬', name: 'è§†é¢‘åˆ›ä½œåŠ©æ‰‹', description: 'åŠ¨ç”»è§†é¢‘ã€æ•°æ®å¯è§†åŒ–' },
]

/* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                           Hook å®ç°                                       â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */
export function useQuickStart() {
  const [scenarios, setScenarios] = useState<QuickStartItem[]>(DEFAULT_SCENARIOS)
  const [isCustomized, setIsCustomized] = useState(false)

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * åˆå§‹åŒ–ï¼šä» localStorage åŠ è½½é…ç½®
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  useEffect(() => {
    const saved = localStorage.getItem(STORAGE_KEY)
    if (saved) {
      try {
        const parsed = JSON.parse(saved)
        if (Array.isArray(parsed) && parsed.length > 0) {
          setScenarios(parsed)
          setIsCustomized(true)
        }
      } catch {
        /* è§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½® */
      }
    }
  }, [])

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * ä¿å­˜åœºæ™¯é…ç½®
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const saveScenarios = useCallback((items: QuickStartItem[]) => {
    const trimmed = items.slice(0, MAX_ITEMS)
    localStorage.setItem(STORAGE_KEY, JSON.stringify(trimmed))
    setScenarios(trimmed)
    setIsCustomized(true)
  }, [])

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * é‡ç½®ä¸ºé»˜è®¤é…ç½®
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const resetToDefault = useCallback(() => {
    localStorage.removeItem(STORAGE_KEY)
    setScenarios(DEFAULT_SCENARIOS)
    setIsCustomized(false)
  }, [])

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * æ·»åŠ åœºæ™¯
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const addScenario = useCallback((item: QuickStartItem) => {
    setScenarios(prev => {
      if (prev.length >= MAX_ITEMS) return prev
      if (prev.some(s => s.skillId === item.skillId)) return prev
      const next = [...prev, item]
      localStorage.setItem(STORAGE_KEY, JSON.stringify(next))
      setIsCustomized(true)
      return next
    })
  }, [])

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * ç§»é™¤åœºæ™¯
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const removeScenario = useCallback((skillId: string) => {
    setScenarios(prev => {
      const next = prev.filter(s => s.skillId !== skillId)
      localStorage.setItem(STORAGE_KEY, JSON.stringify(next))
      setIsCustomized(true)
      return next
    })
  }, [])

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * ç§»åŠ¨åœºæ™¯ä½ç½®
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const moveScenario = useCallback((skillId: string, direction: 'up' | 'down') => {
    setScenarios(prev => {
      const index = prev.findIndex(s => s.skillId === skillId)
      if (index === -1) return prev

      const newIndex = direction === 'up' ? index - 1 : index + 1
      if (newIndex < 0 || newIndex >= prev.length) return prev

      const next = [...prev]
      ;[next[index], next[newIndex]] = [next[newIndex], next[index]]

      localStorage.setItem(STORAGE_KEY, JSON.stringify(next))
      setIsCustomized(true)
      return next
    })
  }, [])

  return {
    scenarios,
    isCustomized,
    saveScenarios,
    resetToDefault,
    addScenario,
    removeScenario,
    moveScenario,
    maxItems: MAX_ITEMS,
    defaultScenarios: DEFAULT_SCENARIOS,
  }
}
