/* ╔══════════════════════════════════════════════════════════════════════════╗
 * ║                     MEMORY.md Manager                                    ║
 * ║                                                                          ║
 * ║  职责：管理 MEMORY.md（全局长期记忆）的读写操作                             ║
 * ║  设计：用户可直接编辑，Labor 可追加学习成果                                ║
 * ╚══════════════════════════════════════════════════════════════════════════╝ */

import { existsSync, readFileSync, writeFileSync } from 'fs'
import { GLOBAL_MEMORY_MD_PATH } from './file-manager.js'

/* ┌──────────────────────────────────────────────────────────────────────────┐
 * │                     Global Memory Manager 类                             │
 * └──────────────────────────────────────────────────────────────────────────┘ */
export class GlobalMemoryManager {
  /* ────────────────────────────────────────────────────────────────────────
   *  读取 MEMORY.md
   * ──────────────────────────────────────────────────────────────────────── */
  read(): string | null {
    if (!existsSync(GLOBAL_MEMORY_MD_PATH)) return null
    return readFileSync(GLOBAL_MEMORY_MD_PATH, 'utf-8')
  }

  /* ────────────────────────────────────────────────────────────────────────
   *  更新 MEMORY.md
   * ──────────────────────────────────────────────────────────────────────── */
  update(content: string): void {
    writeFileSync(GLOBAL_MEMORY_MD_PATH, content, 'utf-8')
  }

  /* ────────────────────────────────────────────────────────────────────────
   *  获取 MEMORY.md 路径
   * ──────────────────────────────────────────────────────────────────────── */
  getPath(): string {
    return GLOBAL_MEMORY_MD_PATH
  }
}

/* ┌──────────────────────────────────────────────────────────────────────────┐
 * │                           导出单例                                        │
 * └──────────────────────────────────────────────────────────────────────────┘ */
export const globalMemoryManager = new GlobalMemoryManager()
