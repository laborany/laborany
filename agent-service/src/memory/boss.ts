/* ╔══════════════════════════════════════════════════════════════════════════╗
 * ║                     BOSS.md Manager                                       ║
 * ║                                                                          ║
 * ║  职责：管理 BOSS.md（老板工作手册）的读写操作                               ║
 * ║  设计：用户可直接编辑，Labor 可建议更新                                    ║
 * ╚══════════════════════════════════════════════════════════════════════════╝ */

import { existsSync, readFileSync, writeFileSync } from 'fs'
import { BOSS_MD_PATH } from './file-manager.js'

/* ┌──────────────────────────────────────────────────────────────────────────┐
 * │                           类型定义                                        │
 * └──────────────────────────────────────────────────────────────────────────┘ */
interface UpdateSuggestion {
  section: string
  content: string
  reason: string
  approved: boolean
}

interface SuggestParams {
  section: string
  content: string
  reason: string
}

/* ┌──────────────────────────────────────────────────────────────────────────┐
 * │                     BOSS Manager 类                                      │
 * └──────────────────────────────────────────────────────────────────────────┘ */
export class BossManager {
  /* ────────────────────────────────────────────────────────────────────────
   *  读取 BOSS.md
   * ──────────────────────────────────────────────────────────────────────── */
  read(): string | null {
    if (!existsSync(BOSS_MD_PATH)) return null
    return readFileSync(BOSS_MD_PATH, 'utf-8')
  }

  /* ────────────────────────────────────────────────────────────────────────
   *  更新 BOSS.md
   * ──────────────────────────────────────────────────────────────────────── */
  update(content: string): void {
    writeFileSync(BOSS_MD_PATH, content, 'utf-8')
  }

  /* ────────────────────────────────────────────────────────────────────────
   *  建议更新（返回建议，不直接更新）
   * ──────────────────────────────────────────────────────────────────────── */
  suggest(params: SuggestParams): UpdateSuggestion {
    return {
      ...params,
      approved: false,
    }
  }

  /* ────────────────────────────────────────────────────────────────────────
   *  获取 BOSS.md 路径
   * ──────────────────────────────────────────────────────────────────────── */
  getPath(): string {
    return BOSS_MD_PATH
  }
}

/* ┌──────────────────────────────────────────────────────────────────────────┐
 * │                           导出单例                                        │
 * └──────────────────────────────────────────────────────────────────────────┘ */
export const bossManager = new BossManager()
